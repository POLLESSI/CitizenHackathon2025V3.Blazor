@inject IJSRuntime JSRuntime
@inject NavigationManager NavManager

@if (showDialog)
{
    <div class="rgpd-overlay">
        <div class="rgpd-modal">
            <h2>Consentement à la collecte de données</h2>
            <p>
                OutZen vous propose des informations en temps réel sur la météo, le trafic, l'affluence et des suggestions d'activités proches.
                Ces données sont liées à l'événement que vous consultez, jamais à votre position personnelle.
            </p>
            <p>
                Acceptez-vous que OutZen analyse ces données pour vous proposer les meilleures alternatives ?
            </p>
            <div class="rgpd-actions">
                <button @onclick="Accept" class="accept">J'accepte</button>
                <button @onclick="Decline" class="decline">Je refuse</button>
            </div>
        </div>
    </div>
}

@code {
    private bool showDialog = false;
    private const string StorageKey = "OutZenConsentGiven";

    protected override async Task OnInitializedAsync()
    {
        var value = await JSRuntime.InvokeAsync<string>("localStorage.getItem", StorageKey);
        showDialog = string.IsNullOrWhiteSpace(value);
    }

    private async Task Accept()
    {
        await JSRuntime.InvokeVoidAsync("localStorage.setItem", StorageKey, "true");
        showDialog = false;
        StateHasChanged();
    }

    private void Decline()
    {
        // Redirects to a neutral page
        NavManager.NavigateTo("https://wallonieenpoche.be");
    }
}













































































    /*// Copyrigtht (c) 2025 Citizen Hackathon https://github.com/POLLESSI/Citizenhackathon2025V3.Blazor.Client. All rights reserved.*/